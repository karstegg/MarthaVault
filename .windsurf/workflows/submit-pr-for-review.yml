name: Submit Pull Request for Review
description: Creates a new branch, commits changes, pushes the branch, and creates a Pull Request for Claude's review.
author: Gemini 2.5 Pro

inputs:
  - name: branch_name
    type: string
    description: "The name for the new feature branch (e.g., 'feat/update-readme')."
    required: true
  - name: commit_message
    type: string
    description: "The commit message for the changes."
    required: true
  - name: pr_title
    type: string
    description: "The title for the Pull Request."
    required: true
  - name: pr_body
    type: string
    description: "The detailed body/description for the Pull Request. Should tag @claude-code."
    required: true
  - name: file_to_add
    type: string
    description: "The specific file to add to the commit. Defaults to staging all changes."
    required: false
    default: "."

steps:
  - name: Create and Switch to New Branch
    run: git checkout -b ${{ inputs.branch_name }}
    shell: powershell

  - name: Check for Errors
    run: |
      if ($LASTEXITCODE -ne 0) {
        Write-Error "Failed to create new branch."
        exit 1
      }
    shell: powershell

  - name: Stage Changes
    run: git add ${{ inputs.file_to_add }}
    shell: powershell

  - name: Check for Errors
    run: |
      if ($LASTEXITCODE -ne 0) {
        Write-Error "Failed to stage changes."
        exit 1
      }
    shell: powershell

  - name: Commit Changes
    run: |
      $env:COMMIT_MSG = "${{ inputs.commit_message }}"
      git commit -m $env:COMMIT_MSG
    shell: powershell

  - name: Check for Errors
    run: |
      if ($LASTEXITCODE -ne 0) {
        Write-Error "Failed to commit changes."
        exit 1
      }
    shell: powershell

  - name: Push Branch to Remote
    run: git push -u origin ${{ inputs.branch_name }}
    shell: powershell

  - name: Check for Errors
    run: |
      if ($LASTEXITCODE -ne 0) {
        Write-Error "Failed to push branch to remote."
        exit 1
      }
    shell: powershell

  - name: Create Pull Request
    run: |
      $env:PR_TITLE = "${{ inputs.pr_title }}"
      $env:PR_BODY = "${{ inputs.pr_body }}"
      gh pr create --title $env:PR_TITLE --body $env:PR_BODY
    shell: powershell

  - name: Check for Errors
    run: |
      if ($LASTEXITCODE -ne 0) {
        Write-Error "Failed to create pull request."
        # Attempt to roll back by deleting the remote branch
        git push origin --delete ${{ inputs.branch_name }}
        exit 1
      }
    shell: powershell

  - name: Return to Master Branch
    run: git checkout master
    shell: powershell

  - name: Confirm PR Creation
    run: echo "Pull request created successfully for branch ${{ inputs.branch_name }}."
    shell: powershell
