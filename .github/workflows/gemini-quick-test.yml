name: Gemini Quick File Creation Test

on:
  repository_dispatch:
    types: [gemini-test]

jobs:
  gemini-test:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Quick Gemini File Creation Test
      uses: 'google-github-actions/run-gemini-cli@v0'
      with:
        gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
        settings: |
          {
            "maxSessionTurns": 5,
            "autoAccept": ["list_directory", "read_file", "write_file", "glob"],
            "telemetry": {
              "enabled": false
            }
          }
        prompt: |
          Create a test file in the daily_production structure to validate file creation works.
          
          Use the write_file tool with these exact parameters:
          - file_path: "daily_production/test-gemini-2025-07-14.json"
          - content: '{"test": "success", "date": "2025-07-14", "created_by": "gemini_ai"}'
          
          Then create a markdown file:
          - file_path: "daily_production/test-gemini-2025-07-14.md"  
          - content: "# Test Report\n\nThis file was created by Gemini AI to test file creation capabilities.\n\n**Status**: SUCCESS"
          
          Create both files and confirm they were created successfully.
          
    - name: Verify File Creation
      run: |
        echo "üîç Checking if test files were created..."
        
        if [ -f "daily_production/test-gemini-2025-07-14.json" ]; then
          echo "‚úÖ JSON file created successfully!"
          echo "üìÑ JSON Content:"
          cat daily_production/test-gemini-2025-07-14.json
        else
          echo "‚ùå JSON file was not created"
        fi
        
        if [ -f "daily_production/test-gemini-2025-07-14.md" ]; then
          echo "‚úÖ Markdown file created successfully!"
          echo "üìÑ Markdown Content:"
          cat daily_production/test-gemini-2025-07-14.md
        else
          echo "‚ùå Markdown file was not created"
        fi
        
        # Exit with error if either file is missing
        if [ ! -f "daily_production/test-gemini-2025-07-14.json" ] || [ ! -f "daily_production/test-gemini-2025-07-14.md" ]; then
          echo "‚ùå Test failed - files missing"
          exit 1
        fi