name: 🧪 Gemini Simple Test - Document Summary

on:
  workflow_dispatch:
    inputs:
      file_path:
        description: 'File to summarize (e.g., README.md, CLAUDE.md)'
        required: true
        default: 'CLAUDE.md'

jobs:
  gemini-test:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Test Gemini with Document Summary
      uses: 'google-github-actions/run-gemini-cli@v0.1.11'
      id: gemini_test
      with:
        gemini_model: 'gemini-2.5-flash'
        gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
        settings: |-
          {
            "maxSessionTurns": 3,
            "autoAccept": ["read_file"],
            "telemetry": {"enabled": false}
          }
        prompt: |-
          Please read the file "${{ github.event.inputs.file_path }}" in this repository and provide a concise summary of its contents in 2-3 sentences.
          
          Focus on:
          - What the document is about
          - Key information or instructions it contains
          - Its main purpose
          
          Keep the summary brief and informative.
    
    - name: Display Summary
      run: |
        echo "📄 File: ${{ github.event.inputs.file_path }}"
        echo "✨ Gemini 2.5 Flash Summary:"
        echo "${{ steps.gemini_test.outputs.summary }}"
        
    - name: Test Results
      run: |
        if [ -n "${{ steps.gemini_test.outputs.summary }}" ]; then
          echo "✅ SUCCESS: Gemini 2.5 Flash is working!"
          echo "📊 Model: gemini-2.5-flash"
          echo "🛠️ Tools: autoAccept working"
          echo "📝 Output length: $(echo '${{ steps.gemini_test.outputs.summary }}' | wc -c) characters"
        else
          echo "❌ FAILED: No summary generated"
          exit 1
        fi