name: Keep Codespace Active & Synced

on:
  schedule:
    # Ping every hour to keep Codespace active
    - cron: '0 * * * *'
  workflow_dispatch:
    inputs:
      action:
        description: 'Action to perform'
        required: true
        default: 'ping'
        type: choice
        options:
          - ping
          - sync
          - restart-mcp

jobs:
  keep-active:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Codespace to Keep Active
        if: ${{ inputs.action == 'ping' || github.event_name == 'schedule' }}
        run: |
          echo "🏃 Keeping Codespace active at $(date)"
          echo "📊 This prevents automatic shutdown due to inactivity"
          
      - name: Sync Repository
        if: ${{ inputs.action == 'sync' }}
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 1
          
      - name: Trigger Repository Sync
        if: ${{ inputs.action == 'sync' }}
        run: |
          echo "🔄 Repository sync triggered"
          echo "📋 Latest commit: $(git log -1 --oneline)"
          
      - name: Restart MCP Server
        if: ${{ inputs.action == 'restart-mcp' }}
        run: |
          echo "🔄 MCP server restart triggered"
          echo "📱 WhatsApp MCP will be restarted in Codespace"