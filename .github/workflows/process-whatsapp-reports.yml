name: WhatsApp Production Reports
on:
  schedule:
    - cron: '30 5 * * *'  # 7:30 AM SAST
  workflow_dispatch:
    inputs:
      date:
        description: 'Report date (YYYY-MM-DD)'
        required: false

jobs:
  process-reports:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Repository Dispatch
        run: |
          curl -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.GH_PAT }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/karstegg/MarthaVault/dispatches \
            -d '{
              "event_type": "process-whatsapp-reports",
              "client_payload": {
                "date": "${{ inputs.date || 'today' }}",
                "message": "Process WhatsApp production reports for date: ${{ inputs.date || 'today' }}. Engineers by site: Nchwaning 2: Johan Kotze, Nchwaning 3: Sello Sease, Gloria: Sipho Dubazane, Shafts & Winders: Xavier Peterson. Extract data from WhatsApp group: 27834418149-1537194373@g.us using the running WhatsApp MCP server. Create JSON files: daily_production/data/YYYY-MM-DD_[site].json. Create Markdown: daily_production/YYYY-MM-DD â€“ [Site] Daily Report.md. Follow CLAUDE.md Section 10.1 requirements."
              }
            }'
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}