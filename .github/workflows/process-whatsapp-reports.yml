name: WhatsApp Production Reports
on:
  schedule:
    - cron: '30 5 * * *'  # 7:30 AM SAST
  workflow_dispatch:
    inputs:
      date:
        description: 'Report date (YYYY-MM-DD)'
        required: false

jobs:
  process-reports:
    runs-on: ubuntu-latest
    steps:
      - name: Run Gemini in Codespace
        uses: github/codespaces-action@v1
        with:
          codespace-name: ${{ vars.CODESPACE_NAME }}
          command: |
            gemini --yolo --prompt "Process WhatsApp production reports for date: ${{ inputs.date || 'today' }}
            
            Engineers by site:
            - Nchwaning 2: Johan Kotze
            - Nchwaning 3: Sello Sease  
            - Gloria: Sipho Dubazane
            - Shafts & Winders: Xavier Peterson
            
            Extract data from WhatsApp group: 27834418149-1537194373@g.us using the running WhatsApp MCP server.
            
            Create JSON files: daily_production/data/YYYY-MM-DD_[site].json
            Create Markdown: daily_production/YYYY-MM-DD â€“ [Site] Daily Report.md
            
            Follow CLAUDE.md Section 10.1 requirements:
            - Use REPORT DATE (when received) not data date
            - Include source validation with confidence scores
            - Cross-reference equipment against fleet database
            - Perform BEV vs diesel analysis for Nchwaning 3"
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}